  <link href="http://www.iderail.es/testiss/css/ol.css" rel="stylesheet">
  <style type="text/css">
  .map {
    float: left;
    padding: 10px 10px;
    height: 400px;
    width: 400px;
  }
  .mapOSM {
    float: left;
    padding: 10px 10px;
    height:400px;
    width: 400px;
  }
  .txtISS {
    float: left;
    padding: 5px 5px;
    height:100px;
    width: 100px;
  }
  .txtOSM {
    float: left;
    padding: 5px 5px;
    height:160px;
    width: 160px;
  }
  </style>

<div class="row">
    <!-- Success and Error Messages for the user --> 
    <div class="span6 offset2" style="height:10px">
        <div id="success" class="alert alert-success" style="display:none;">
            <a class="close">×</a>
            <strong>Well done!</strong> Your answer has been saved
        </div>
        <div id="loading" class="alert alert-info" style="display:none;">
            <a class="close">×</a>
            Loading next task...
        </div>
        <div id="taskcompleted" class="alert alert-info" style="display:none;">
            <strong>The task has been completed!</strong> Thanks a lot!
        </div>
        <div id="finish" class="alert alert-success" style="display:none;">
            <strong>Congratulations!</strong> You have participated in all available tasks!
            <br/>
            <div class="alert-actions">
                <a class="btn small" href="/">Go back</a>
                <a class="btn small" href="/app">or, Check other applications</a>
            </div>
        </div>
        <div id="error" class="alert alert-error" style="display:none;">
            <a class="close">×</a>
            <strong>Error!</strong> Something went wrong, please contact the site administrators
        </div>
    </div> <!-- End Success and Error Messages for the user -->
</div> <!-- End of Row -->

<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->
<div class="row skeleton" style="width:1100px"> <!-- Start Skeleton Row-->
    <div class="span12" style="width:1100px"><!-- Start of Question and Submission DIV (column) -->
        <h1 id="question">Do you know about this City?</h1> <!-- The question will be loaded here -->
        <div id="step1" class="btn-group" style="text-align:center"> <!-- Start DIV for the submission buttons -->
            <div id="answer" class="btn-group" style="text-align:center"> <!-- Start DIV for the submission buttons -->
                <!-- If the user clicks this button, the saved answer will be value="black"-->
                <button class="btn btn-large btn-answer" value='save'>Save</button>
                <button class="btn btn-large btn-answer" value='404'>No photo</button>
                <!-- If the user clicks this button, the saved answer will be value="NotKnown"-->
                <button class="btn btn-large btn-answer" value='unknown'>I don't know</button>

            </div><!-- End of DIV for the submission buttons -->
        </div><!-- End of DIV for the submission buttons -->
        

        <!-- These are maps -->
        <div id="map" class="map"></div>
        <div id="mapOSM" class="mapOSM"></div>
        <!-- DataList to send into array  -->
        <form name="dataList">
          <input type=button  class="btn btn-large btn-answer" onClick="removeOptions()"; value='Remove Selected'><br>
            <SELECT id="xyValues" NAME="xyValues" class="txtISS" MULTIPLE size=6 width=5></SELECT>
            <SELECT id="lonlatValues" NAME="lonlatValues" class="txtOSM" MULTIPLE size=6 width=7></SELECT>
        </form>
        
          <!--     -->

    </div><!-- End of DIV for the submission buttons -->
</div><!-- End of DIV for the submission buttons -->


<div class="row skeleton" style="margin-top:15px;"> <!-- Start Skeleton Row-->
    <div class="span8 offset2"><!-- Start of Question and Submission DIV (column) -->
        <p>You are working now on task: <span id="task-id" class="label label-warning">#</span></p>
        <p>You have completed: <span id="done" class="label label-info"></span> tasks from
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="bar" style="width: 0%;"></div>
        </div>
        <!-- 
            This application uses Disqus to allow users to provide some feedback.
            The next section includes a button that when a user clicks on it will
            load the comments, if any, for the given task
        -->
        <div id="disqus_show_btn" style="margin-top:5px;">
            <button class="btn btn-primary btn-large btn-disqus" onclick="loadDisqus()"><i class="icon-comments"></i> Show comments</button>
            <button class="btn btn-large btn-disqus" onclick="loadDisqus()" style="display:none"><i class="icon-comments"></i> Hide comments</button>
        </div><!-- End of Disqus Button section -->
        <!-- Disqus thread for the given task -->
        <div id="disqus_thread" style="margin-top:5px;display:none"></div>
    </div><!-- End of Question and Submission DIV (column) -->
</div><!-- End of Skeleton Row -->

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    /* * * DON'T EDIT BELOW THIS LINE * * */
    function loadDisqus() {
    $("#disqus_thread").toggle();
    $(".btn-disqus").toggle();
    var disqus_shortname = 'pybossa'; // required: replace example with your forum shortname
    //var disqus_identifier = taskId;
    var disqus_developer = 1;

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    }

</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 <script src="http://www.iderail.es/testiss/js/ol.js" type="text/javascript"></script>
 
<script>
function loadUserProgress() {
    pybossa.userProgress('nightcitiesiss0').done(function(data){
        var pct = Math.round((data.done*100)/data.total);
        $("#progress").css("width", pct.toString() +"%");
        $("#progress").attr("title", pct.toString() + "% completed!");
        $("#progress").tooltip({'placement': 'left'}); 
        $("#total").text(data.total);
        $("#done").text(data.done);
    });
}



pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        console.log('dentro de taskLoaded');

        //deferred.resolve(task);        
        task.answer = {
            
            'XY': '',
            'LONLAT': '',
            'img_big': task.info.link_big,
            'sharp': ''
        }
        console.log('1.- id de la tarea ' + task.id);
        console.log('1.- link a la imagen ' + task.info.link_big);
        console.log('1.- Localicacion de la image Loaded ' + task.info.citylon + ' ' + task.info.citylat);
        console.log('1.- Focal ' + task.info.focal);
        console.log('------------------------------------------');

        deferred.resolve(task);        
    }
    else {
        deferred.resolve(task);
    }
});

pybossa.presentTask(function(task, deferred) {
    console.log('en presentTask');
    if ( !$.isEmptyObject(task) ) {
        
        loadUserProgress();
        $("#question").html(task.info.question);
        $('#task-id').html(task.id);
        $('.btn-answer').off('click').on('click', function(evt) {

            var answer = $(evt.target).attr("value");


            if (typeof answer != 'undefined') {

              if (answer == 'save'){

                console.log('SAVE ');
                $("#step1").hide();
                
                task.answer.XY = 'xy';
                task.answer.LONLAT = 'lnlat';
                xy = '';
                lonlat = '';
                console.log('2.- id de la tarea ' + task.id);
                console.log('2.- Localicacion de la image Loaded ' + task.info.citylon + ' ' + task.info.citylat);
                console.log('Saved task.answer.XY ' + task.answer.XY);
                console.log('Saved task.answer.LONLAT ' + task.answer.LONLAT);
                console.log('Saved img_big ' + task.info.link_big);

                pybossa.saveTask(task.id, task.answer).done(function() {
                    deferred.resolve();
                });

                $("#step1").show();
                console.log('despues del show');

              }else if (answer == '404'){
                console.log('404 ');
                changeMapOSM(0,0,5);
                deferred.resolve(task);
              }else {
                console.log('no foto');
                deferred.resolve(task);
              }

            }
        });
        $("#loading").hide();
    }
    else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    }
});

pybossa.run('nightcitiesiss0');
</script>